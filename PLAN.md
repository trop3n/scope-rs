# scope-rs - Implementation Plan

An oscilloscope audio visualizer inspired by sosci. Displays audio input as real-time XY oscilloscope graphics.

## Current Status

**Completed through Milestones 10, 11, 12, 14, 15 & 16** - The app has:
- Audio input capture with cpal (reactive gain control)
- Device selection dropdown
- XY oscilloscope display with persistence/afterglow
- Multiple display modes (Dots, Lines, Gradient, Points)
- Channel controls (swap X/Y, invert, DC offset)
- Color themes (Green, Amber, Blue, White, Purple, Cyan, Red)
- Audio file playback with symphonia (WAV, MP3, FLAC, OGG, etc.)
- Audio output during file playback (via cpal output stream)
- Waveform overview with seek bar
- Playback controls (play/pause/stop, loop, volume, speed)
- Settings panel with all controls
- Lock-free audio (SPSC ring buffers)
- Settings persistence (serde JSON, auto-save/load)
- MIDI CC input with parameter mapping and MIDI learn
- Modular code structure (audio/, render/)
- Zero compiler warnings
- GitHub Actions CI/CD (build, test, lint on 3 platforms)
- Automated release binary creation on git tags

## Project Structure

```
scope-rs/
├── Cargo.toml
├── PLAN.md                 # This file
├── .github/
│   └── workflows/
│       ├── ci.yml          # CI: build + test + lint (3 platforms)
│       └── release.yml     # Release: build binaries on tag push
├── docs/
│   ├── 14-serialization.md
│   ├── 15-midi.md
│   └── 16-distribution.md
└── src/
    ├── main.rs             # App entry point
    ├── settings.rs         # Settings persistence (serde JSON)
    ├── midi.rs             # MIDI input + CC parameter mapping
    ├── audio/
    │   ├── mod.rs
    │   ├── buffer.rs       # SampleBuffer, XYSample (Arc<Mutex<T>>)
    │   ├── input.rs        # AudioInput (cpal input capture)
    │   └── file.rs         # AudioFilePlayer (symphonia playback)
    └── render/
        ├── mod.rs
        └── oscilloscope.rs # XY display widget with persistence
```

## Tech Stack

- **Rust** (2021 edition)
- **eframe/egui** - Immediate-mode GUI
- **cpal** - Cross-platform audio I/O

## Milestones

### Phase 1: Foundations ✅

#### Milestone 2: Hello Input ✅
- [x] Project setup with Cargo
- [x] cpal audio input capture
- [x] Device enumeration and selection
- [x] Basic eframe window

#### Milestone 3: Oscilloscope Display ✅
- [x] Ring buffer for audio↔UI communication
- [x] XY oscilloscope widget
- [x] Persistence/afterglow effect
- [x] Settings panel

---

### Phase 3: Core Features ✅

#### Milestone 10: Audio Visualization Polish ✅
**Goal:** Full-featured audio visualizer

**Deliverables:**
- [x] Multiple display modes (Dots, Lines, Gradient, Points)
- [x] Channel controls (swap X/Y, invert X/Y, DC offset)
- [x] Color/theme options (7 presets)
- [ ] Device hot-plug detection (deferred)

#### Milestone 11: Audio File Playback ✅
**Goal:** Load and visualize audio files

**Rust concepts:** Audio decoding, playback control

**Deliverables:**
- [x] Audio file loading (`symphonia` crate)
- [x] Playback controls (play/pause/stop/seek)
- [x] Waveform overview display with seeking
- [x] Volume and speed controls
- [x] Loop mode
- [ ] `docs/11-audio-files.md` (documentation pending)

---

### Phase 4: Advanced Features

#### Milestone 12: Lock-Free Audio ✅
- [x] Replace `Arc<Mutex<T>>` with lock-free ring buffer (`ringbuf` crate)
- [x] SPSC producer/consumer pattern for audio↔UI communication
- [x] Verify no audio glitches under load
- [x] `docs/12-lock-free.md` (in osci-rs/docs/)

#### Milestone 14: Settings Persistence ✅
- [x] Serde serialization for settings
- [x] Auto-save/load preferences
- [x] `docs/14-serialization.md`

#### Milestone 15: MIDI Control ✅
- [x] MIDI input (`midir`)
- [x] Parameter mapping (9 parameters, MIDI learn, persist mappings)
- [x] `docs/15-midi.md`

#### Milestone 16: Distribution ✅
- [x] Cargo release profile (LTO, strip, codegen-units, panic=abort)
- [x] GitHub Actions CI (build + test + fmt + clippy on 3 platforms)
- [x] GitHub Actions release workflow (automated binaries on tag push)
- [x] `docs/16-distribution.md`

---

## Dependencies (Current)

```toml
[dependencies]
eframe = "0.29"
cpal = "0.15"
symphonia = { version = "0.5", features = ["all"] }
rfd = "0.15"
thiserror = "2.0"
ringbuf = "0.4"
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
dirs = "6.0"
midir = "0.10"
log = "0.4"
env_logger = "0.11"
```

---

## Running

```bash
cargo run
```

Select an input device, click "Capture" to visualize audio as XY oscilloscope graphics.

## Testing with osci-rs

You can route osci-rs output to scope-rs:
1. Run osci-rs and click Play (generates circle)
2. Use a virtual audio cable or loopback to route output to input
3. Run scope-rs and select the loopback device
4. You should see the circle generated by osci-rs

## Related Project

**osci-rs** - The companion generator app that creates audio from shapes/graphics.

---

## Context for AI Assistants

This project is part of a Rust learning journey. The user is a beginner learning Rust by building practical applications.

The code prioritizes clarity and educational value over maximum performance. For example, we use `Arc<Mutex<T>>` for thread communication (simple to understand) rather than lock-free structures (which come in Milestone 12).

When continuing development:
1. Check current milestone status above
2. Review existing code structure
3. Follow the pattern of existing modules
4. Explain Rust concepts as they appear
