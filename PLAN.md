# scope-rs - Implementation Plan

An oscilloscope audio visualizer inspired by sosci. Displays audio input as real-time XY oscilloscope graphics.

## Current Status

**Completed through Milestone 3** - The app has:
- Audio input capture with cpal
- Device selection dropdown
- XY oscilloscope display with persistence/afterglow
- Settings panel (gain, zoom, line width, intensity, color presets)
- Modular code structure (audio/, render/)

## Project Structure

```
scope-rs/
├── Cargo.toml
├── PLAN.md                 # This file
└── src/
    ├── main.rs             # App entry point
    ├── audio/
    │   ├── mod.rs
    │   ├── buffer.rs       # SampleBuffer, XYSample (Arc<Mutex<T>>)
    │   └── input.rs        # AudioInput (cpal input capture)
    └── render/
        ├── mod.rs
        └── oscilloscope.rs # XY display widget with persistence
```

## Tech Stack

- **Rust** (2021 edition)
- **eframe/egui** - Immediate-mode GUI
- **cpal** - Cross-platform audio I/O

## Milestones

### Phase 1: Foundations ✅

#### Milestone 2: Hello Input ✅
- [x] Project setup with Cargo
- [x] cpal audio input capture
- [x] Device enumeration and selection
- [x] Basic eframe window

#### Milestone 3: Oscilloscope Display ✅
- [x] Ring buffer for audio↔UI communication
- [x] XY oscilloscope widget
- [x] Persistence/afterglow effect
- [x] Settings panel

---

### Phase 3: Core Features (Next)

#### Milestone 10: Audio Visualization Polish
**Goal:** Full-featured audio visualizer

**Deliverables:**
- [ ] Multiple display modes (dots, lines, gradient)
- [ ] Gain and DC offset controls (improved)
- [ ] Color/theme options (more presets)
- [ ] Device hot-plug detection

#### Milestone 11: Audio File Playback
**Goal:** Load and visualize audio files

**Rust concepts:** Audio decoding, playback control

**Deliverables:**
- [ ] Audio file loading (`symphonia` crate)
- [ ] Playback controls (play/pause/seek)
- [ ] Waveform overview display
- [ ] `docs/11-audio-files.md`

---

### Phase 4: Advanced Features

#### Milestone 12: Lock-Free Audio
- [ ] Replace `Arc<Mutex<T>>` with lock-free ring buffer
- [ ] Verify no audio glitches under load
- [ ] `docs/12-lock-free.md`

#### Milestone 14: Settings Persistence
- [ ] Serde serialization for settings
- [ ] Auto-save/load preferences
- [ ] `docs/14-serialization.md`

#### Milestone 15: MIDI Control
- [ ] MIDI input (`midir`)
- [ ] Parameter mapping
- [ ] `docs/15-midi.md`

#### Milestone 16: Distribution
- [ ] Windows/macOS builds
- [ ] Performance profiling
- [ ] `docs/16-distribution.md`

---

## Dependencies (Current)

```toml
[dependencies]
eframe = "0.29"
cpal = "0.15"
log = "0.4"
env_logger = "0.11"
```

## Dependencies (Planned)

```toml
# Milestone 11+
ringbuf = "0.4"
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
thiserror = "2.0"
rfd = "0.15"
symphonia = "0.5"
midir = "0.10"
```

---

## Running

```bash
cargo run
```

Select an input device, click "Capture" to visualize audio as XY oscilloscope graphics.

## Testing with osci-rs

You can route osci-rs output to scope-rs:
1. Run osci-rs and click Play (generates circle)
2. Use a virtual audio cable or loopback to route output to input
3. Run scope-rs and select the loopback device
4. You should see the circle generated by osci-rs

## Related Project

**osci-rs** - The companion generator app that creates audio from shapes/graphics.

---

## Context for AI Assistants

This project is part of a Rust learning journey. The user is a beginner learning Rust by building practical applications.

The code prioritizes clarity and educational value over maximum performance. For example, we use `Arc<Mutex<T>>` for thread communication (simple to understand) rather than lock-free structures (which come in Milestone 12).

When continuing development:
1. Check current milestone status above
2. Review existing code structure
3. Follow the pattern of existing modules
4. Explain Rust concepts as they appear
